<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Deploy your archive warriors the proper way, with Kubernetes | Asier's Webpage</title><meta name=keywords content><meta name=description content="Last time I used a script to create multiple containers simultaneously. Although it works, let&rsquo;s say it&rsquo;s not the best option.
Kubernetes is the optimal choice for tasks like these due to its ability to orchestrate multiple containers, scale them, balance the load among nodes when required, and ensure container availability.
For this reason, I have decided to perform a small deployment of 6 pods that perform the same function as the containers in the previous attempt."><meta name=author content="Asier Jiménez"><link rel=canonical href=https://123jimenez99.github.io/posts/deploy-your-archive-team-warriors-properly-with-kubernetes.html><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=../assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=../assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://123jimenez99.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://123jimenez99.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://123jimenez99.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://123jimenez99.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://123jimenez99.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Deploy your archive warriors the proper way, with Kubernetes"><meta property="og:description" content="Last time I used a script to create multiple containers simultaneously. Although it works, let&rsquo;s say it&rsquo;s not the best option.
Kubernetes is the optimal choice for tasks like these due to its ability to orchestrate multiple containers, scale them, balance the load among nodes when required, and ensure container availability.
For this reason, I have decided to perform a small deployment of 6 pods that perform the same function as the containers in the previous attempt."><meta property="og:type" content="article"><meta property="og:url" content="https://123jimenez99.github.io/posts/deploy-your-archive-team-warriors-properly-with-kubernetes.html"><meta property="og:image" content="https://123jimenez99.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-26T22:02:51+02:00"><meta property="article:modified_time" content="2023-08-26T22:02:51+02:00"><meta property="og:site_name" content="Asier's Webpage"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://123jimenez99.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Deploy your archive warriors the proper way, with Kubernetes"><meta name=twitter:description content="Last time I used a script to create multiple containers simultaneously. Although it works, let&rsquo;s say it&rsquo;s not the best option.
Kubernetes is the optimal choice for tasks like these due to its ability to orchestrate multiple containers, scale them, balance the load among nodes when required, and ensure container availability.
For this reason, I have decided to perform a small deployment of 6 pods that perform the same function as the containers in the previous attempt."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Deploy your archive warriors the proper way, with Kubernetes","item":"https://123jimenez99.github.io/posts/deploy-your-archive-team-warriors-properly-with-kubernetes.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deploy your archive warriors the proper way, with Kubernetes","name":"Deploy your archive warriors the proper way, with Kubernetes","description":"Last time I used a script to create multiple containers simultaneously. Although it works, let\u0026rsquo;s say it\u0026rsquo;s not the best option.\nKubernetes is the optimal choice for tasks like these due to its ability to orchestrate multiple containers, scale them, balance the load among nodes when required, and ensure container availability.\nFor this reason, I have decided to perform a small deployment of 6 pods that perform the same function as the containers in the previous attempt.","keywords":[],"articleBody":" Last time I used a script to create multiple containers simultaneously. Although it works, let’s say it’s not the best option.\nKubernetes is the optimal choice for tasks like these due to its ability to orchestrate multiple containers, scale them, balance the load among nodes when required, and ensure container availability.\nFor this reason, I have decided to perform a small deployment of 6 pods that perform the same function as the containers in the previous attempt. To create multiple Archive Warriors to assist with the Archive Team’s objective. If you want to learn more about this, I encourage you to read my previous article where I discuss this in greater depth.\nTo make this possible, a cluster with one or more nodes must be created. In this case, I’ll use minikube, a very simple tool that will automatically allow us to create such a cluster.\nThere are multiple ways to install minikube, in my case I’ve used the packages provided by the official Arch Linux repositories. It is also necessary to have Docker or a hypervisor like QEMU installed, as suggested by the minikube documentation.\nTo start the cluster with minikube just run the minikube start command. In the case of using Docker on Linux, ensure your user belongs to the docker group before starting the Docker service.\nTo interact with Kubernetes I’ll use kubectl, which I’ve assigned the alias k on my machine. Depending on the distribution or operating system used, it may be necessary to install kubectl separately.\nTo view the node minikube has just created, use the kubectl get nodes command.\nNow that everything is in check, let’s move on to the important bit, the deployment.\napiVersion: apps/v1 kind: Deployment metadata: name: archiveteam-deployment spec: replicas: 6 selector: matchLabels: app: archiveteam template: metadata: labels: app: archiveteam spec: containers: - name: archiveteam-container image: atdr.meo.ws/archiveteam/warrior-dockerfile:latest env: - name: DOWNLOADER value: \"Pico\" - name: SELECTED_PROJECT value: \"reddit\" - name: CONCURRENT_ITEMS value: \"6\"\nThis is a very simple deployment making use of 6 pods. The same docker image and environment variables as last time have been used.\nTo perform the deployment, save the code in a text file using the YAML format and run it by executing the kubectl apply -f command.\nIt seems like the deployment has proceeded without any issues so far. The containers are being created and in the process of being executed. We can verify this with the kubectl get pods command.\nIf you quickly execute the kubectl get pods command you can see how the containers are not fully created yet, just give them a moment.\nAfter waiting for a few seconds and checking the pod status again, it can be seen how these are running and ready. Excellent!\nIf my memory serves me right, these containers had some kind of dashboard where it was possible to visualize the tasks these perform in real time. AFAIK there’s no way to access them directly as I’ve done in the past. Because of the architecture of Kubernetes, the pods run in a different network.\nThe pods are in the 10.244.0.0 network while my computer is in the 192.168.18.0 network.\nA simple way to solve this problem is to forward the port the container uses for the control panel to an unused port on the host machine.\nFor instance, if the container uses the port 8001 for the dashboard and we want to access it, simply execute this command: kubectl port-forward archiveteam-deployment-7f47c7789f-cf5tq 8001:8001\nNow it can be seen how that poor warrior is doing it’s best.\nAs you can see creating a deployment with Kubernetes is quite straightforward and very useful. It can even be used for doing good deeds!\n","wordCount":"611","inLanguage":"en","datePublished":"2023-08-26T22:02:51+02:00","dateModified":"2023-08-26T22:02:51+02:00","author":{"@type":"Person","name":"Asier Jiménez"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://123jimenez99.github.io/posts/deploy-your-archive-team-warriors-properly-with-kubernetes.html"},"publisher":{"@type":"Organization","name":"Asier's Webpage","logo":{"@type":"ImageObject","url":"https://123jimenez99.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://123jimenez99.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://123jimenez99.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://123jimenez99.github.io/about.html title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://123jimenez99.github.io/>Home</a></div><h1 class=post-title>Deploy your archive warriors the proper way, with Kubernetes</h1><div class=post-meta><span title='2023-08-26 22:02:51 +0200 CEST'>August 26, 2023</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;611 words&nbsp;·&nbsp;Asier Jiménez</div></header><div class=post-content><p><img loading=lazy src=./images/k_get_pods_main.png alt="k get pods main"></p><p><a href=https://123jimenez99.github.io/posts/multiply_archive_team_warrior_instances_with_docker.html>Last time</a> I used a script to create multiple containers simultaneously. Although it works, let&rsquo;s say it&rsquo;s not the best option.</p><p>Kubernetes is the optimal choice for tasks like these due to its ability to orchestrate multiple containers, scale them, balance the load among nodes when required, and ensure container availability.</p><p>For this reason, I have decided to perform a small deployment of 6 pods that perform the same function as the containers in <a href=https://123jimenez99.github.io/posts/multiply_archive_team_warrior_instances_with_docker.html>the previous attempt</a>. To create multiple Archive Warriors to assist with the Archive Team’s objective. If you want to learn more about this, I encourage you to read <a href=https://123jimenez99.github.io/posts/multiply_archive_team_warrior_instances_with_docker.html>my previous article</a> where I discuss this in greater depth.</p><p>To make this possible, a cluster with one or more nodes must be created. In this case, I’ll use minikube, a very simple tool that will automatically allow us to create such a cluster.</p><p>There are multiple ways to install minikube, in my case I’ve used the packages provided by the official Arch Linux repositories. It is also necessary to have Docker or a hypervisor like QEMU installed, as suggested by the minikube <a href=https://minikube.sigs.k8s.io/docs/drivers/>documentation</a>.</p><p><img loading=lazy src=./images/install_prompt.png alt="install prompt"></p><p>To start the cluster with minikube just run the <strong>minikube start</strong> command. In the case of using Docker on Linux, ensure your user belongs to the <strong>docker</strong> group before starting the Docker service.</p><p><img loading=lazy src=./images/configure_user.png alt="configure user"></p><p>To interact with Kubernetes I&rsquo;ll use <strong>kubectl</strong>, which I&rsquo;ve assigned the alias <strong>k</strong> on my machine. Depending on the distribution or operating system used, it may be necessary to install kubectl separately.</p><p>To view the node minikube has just created, use the <strong>kubectl get nodes</strong> command.</p><p><img loading=lazy src=./images/k_get_nodes.png alt="k get nodes"></p><p>Now that everything is in check, let&rsquo;s move on to the important bit, the deployment.</p><p><code>apiVersion: apps/v1 kind: Deployment metadata: name: archiveteam-deployment spec: replicas: 6 selector: matchLabels: app: archiveteam template: metadata: labels: app: archiveteam spec: containers: - name: archiveteam-container image: atdr.meo.ws/archiveteam/warrior-dockerfile:latest env: - name: DOWNLOADER value: "Pico" - name: SELECTED_PROJECT value: "reddit" - name: CONCURRENT_ITEMS value: "6"</code></p><p>This is a very simple deployment making use of 6 pods. The same docker image and environment variables as <a href=https://123jimenez99.github.io/posts/multiply_archive_team_warrior_instances_with_docker.html>last time</a> have been used.</p><p>To perform the deployment, save the code in a text file using the YAML format and run it by executing the <strong>kubectl apply -f</strong> command.</p><p><img loading=lazy src=./images/apply_deploy.png alt="apply deploy"></p><p>It seems like the deployment has proceeded without any issues so far. The containers are being created and in the process of being executed. We can verify this with the <strong>kubectl get pods</strong> command.</p><p><img loading=lazy src=./images/ready00.png alt=ready00></p><blockquote><p>If you quickly execute the <strong>kubectl get pods</strong> command you can see how the containers are not fully created yet, just give them a moment.</p></blockquote><p>After waiting for a few seconds and checking the pod status again, it can be seen how these are running and ready. Excellent!</p><p><img loading=lazy src=./images/ready1.png alt=ready1></p><p>If my memory serves me right, these containers had some kind of dashboard where it was possible to visualize the tasks these perform in real time. AFAIK there&rsquo;s no way to access them directly as I&rsquo;ve done in the past. Because of the architecture of Kubernetes, the pods run in a different network.</p><p><img loading=lazy src=./images/get_pods_o_wide.png alt="get pods o wide"></p><blockquote><p>The pods are in the 10.244.0.0 network while my computer is in the 192.168.18.0 network.</p></blockquote><p>A simple way to solve this problem is to forward the port the container uses for the control panel to an unused port on the host machine.</p><p>For instance, if the container uses the port 8001 for the dashboard and we want to access it, simply execute this command: <strong>kubectl port-forward archiveteam-deployment-7f47c7789f-cf5tq 8001:8001</strong></p><p><img loading=lazy src=./images/result.png alt=result></p><blockquote><p>Now it can be seen how that poor warrior is doing it&rsquo;s best.</p></blockquote><p>As you can see creating a deployment with Kubernetes is quite straightforward and very useful. It can even be used for doing good deeds!</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://123jimenez99.github.io/posts/multiply_archive_team_warrior_instances_with_docker.html><span class=title>Next »</span><br><span>Multiply your Archive Team Warriors with Docker and some little scripting</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://123jimenez99.github.io/>Asier's Webpage</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>